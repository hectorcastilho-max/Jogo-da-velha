<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Damas Moderno — IA</title>
<style>
:root{
  --light:#f0d9b5;
  --dark:#b58863;
  --accent:#3b82f6;
  --piece-red:#d32f2f;
  --piece-black:#222;
  --board-size:400px;
}
body{
  margin:0;
  font-family:Inter,sans-serif;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background: linear-gradient(135deg,#fff3e0,#ffe0b2);
}
h1{margin-bottom:12px;color:#1f2937;}
#container{display:flex;gap:20px;}
#board {display:grid; grid-template-columns:repeat(8,1fr); grid-template-rows:repeat(8,1fr); width:var(--board-size); height:var(--board-size); box-shadow:0 8px 24px rgba(0,0,0,0.2);}
.cell {width:100%; height:100%; display:flex; align-items:center; justify-content:center; cursor:pointer; user-select:none; transition:0.1s; position:relative;}
.cell.light {background: var(--light);}
.cell.dark {background: var(--dark);}
.cell.selected{outline:3px solid var(--accent);}
.piece {width:80%; height:80%; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; color:white; font-size:20px; transition:0.2s;}
.piece.red{background:var(--piece-red);}
.piece.black{background:var(--piece-black);}
#captured{display:flex; flex-direction:column; gap:12px;}
.captured-row{display:flex; gap:4px;}
.controls {margin-top:12px; display:flex; gap:10px;}
button {padding:8px 12px; border:none; border-radius:10px; cursor:pointer; font-weight:600;}
button:hover {transform:translateY(-2px);}
.btn-primary {background:linear-gradient(90deg,var(--accent),#60a5fa); color:white;}
#status {margin-top:8px; font-weight:600;}
</style>
</head>
<body>

<h1>Damas Moderno</h1>
<div id="container">
  <div id="board"></div>
  <div id="captured">
    <div>Peças capturadas:</div>
    <div id="redCaptured" class="captured-row">Vermelhas: </div>
    <div id="blackCaptured" class="captured-row">Pretas: </div>
  </div>
</div>
<div id="status">Turno: Vermelho</div>
<div class="controls">
  <button id="restartBtn" class="btn-primary">Reiniciar</button>
  <button id="backBtn">← Menu</button>
  <button id="muteBtn">Música: On</button>
</div>

<audio id="bgAudio" loop autoplay>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_05b1f0a23f.mp3?filename=calm-piano-110599.mp3" type="audio/mpeg">
</audio>

<script>
// ==== CONFIG ====
const board = document.getElementById('board');
const status = document.getElementById('status');
const restartBtn = document.getElementById('restartBtn');
const backBtn = document.getElementById('backBtn');
const muteBtn = document.getElementById('muteBtn');
const bgAudio = document.getElementById('bgAudio');
const redCaptured = document.getElementById('redCaptured');
const blackCaptured = document.getElementById('blackCaptured');

let boardState=[];
let selected=null;
let currentPlayer='red';

// ==== INICIALIZAÇÃO DO TABULEIRO ====
function createBoard(){
  board.innerHTML='';
  boardState=[];
  for(let r=0;r<8;r++){
    let rowArr=[];
    for(let c=0;c<8;c++){
      const cell=document.createElement('div');
      cell.classList.add('cell',(r+c)%2?'dark':'light');
      cell.dataset.row=r;
      cell.dataset.col=c;
      let piece='';
      if((r+c)%2 && r<3) piece='b'; // preta
      if((r+c)%2 && r>4) piece='r'; // vermelha
      if(piece){
        const p=document.createElement('div');
        p.classList.add('piece',piece==='r'?'red':'black');
        p.textContent='';
        cell.appendChild(p);
      }
      board.appendChild(cell);
      rowArr.push(piece);
    }
    boardState.push(rowArr);
  }
}

// ==== RENDER ====
function renderBoard(){
  board.querySelectorAll('.cell').forEach(cell=>{
    const r=parseInt(cell.dataset.row);
    const c=parseInt(cell.dataset.col);
    cell.innerHTML='';
    const piece = boardState[r][c];
    if(piece){
      const p=document.createElement('div');
      p.classList.add('piece',piece==='r'?'red':'black');
      cell.appendChild(p);
    }
    cell.classList.remove('selected');
    if(selected && selected.r===r && selected.c===c) cell.classList.add('selected');
  });
}

// ==== MOVIMENTO + CAPTURA ====
board.addEventListener('click', e=>{
  const cell = e.target.closest('.cell');
  if(!cell) return;
  const r=parseInt(cell.dataset.row);
  const c=parseInt(cell.dataset.col);
  const piece = boardState[r][c];

  if(selected){
    const dr=r-selected.r;
    const dc=c-selected.c;
    // movimento simples diagonal 1 passo
    if(Math.abs(dr)===1 && Math.abs(dc)===1 && !boardState[r][c]){
      boardState[r][c]=boardState[selected.r][selected.c];
      boardState[selected.r][selected.c]='';
      selected=null;
      switchTurn();
    }
    // captura diagonal
    if(Math.abs(dr)===2 && Math.abs(dc)===2){
      const midR=selected.r+dr/2;
      const midC=selected.c+dc/2;
      const captured=boardState[midR][midC];
      if(captured && captured!==boardState[selected.r][selected.c]){
        if(captured==='r') redCaptured.textContent += '● ';
        else blackCaptured.textContent += '● ';
        boardState[midR][midC]='';
        boardState[r][c]=boardState[selected.r][selected.c];
        boardState[selected.r][selected.c]='';
        selected=null;
        switchTurn();
      }
    }
    renderBoard();
  } else {
    if(piece && ((piece==='r' && currentPlayer==='red')||(piece==='b' && currentPlayer==='black'))) selected={r,c};
  }
});

// ==== IA SIMPLES PARA PRETO ====
function aiMove(){
  const moves=[];
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      if(boardState[r][c]==='b'){
        const dirs=[[-1,-1],[-1,1]];
        for(let d of dirs){
          const nr=r+d[0], nc=c+d[1];
          if(nr>=0 && nr<8 && nc>=0 && nc<8){
            if(!boardState[nr][nc]) moves.push({from:{r,c},to:{r:nr,c:nc}});
          }
        }
      }
    }
  }
  if(moves.length>0){
    const m = moves[Math.floor(Math.random()*moves.length)];
    boardState[m.to.r][m.to.c]=boardState[m.from.r][m.from.c];
    boardState[m.from.r][m.from.c]='';
    currentPlayer='red';
    status.textContent='Turno: Vermelho';
    renderBoard();
  }
}

function switchTurn(){
  currentPlayer=currentPlayer==='red'?'black':'red';
  status.textContent=`Turno: ${currentPlayer==='red'?'Vermelho':'Preto'}`;
  if(currentPlayer==='black') setTimeout(aiMove,300);
}

// ==== BOTÕES ====
restartBtn.addEventListener('click', ()=>{
  createBoard();
  redCaptured.textContent='Vermelhas: ';
  blackCaptured.textContent='Pretas: ';
  currentPlayer='red';
  status.textContent='Turno: Vermelho';
  renderBoard();
});
backBtn.addEventListener('click', ()=>{window.open('index.html','_self');});
muteBtn.addEventListener('click', ()=>{
  if(bgAudio.paused){bgAudio.play(); muteBtn.textContent='Música: On';}
  else{bgAudio.pause(); muteBtn.textContent='Música: Off';}
});

createBoard();
renderBoard();
</script>
</body>
</html>
