<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xadrez Moderno — IA</title>
<style>
:root{
  --light:#f0d9b5;
  --dark:#b58863;
  --accent:#3b82f6;
  --white:#fff;
  --black:#222;
  --board-size:480px;
}
body{
  margin:0;
  font-family:Inter,sans-serif;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background: linear-gradient(135deg,#e3f2fd,#bbdefb);
}
h1{margin-bottom:12px;color:#1f2937;}
#container{display:flex;gap:20px;}
#board {display:grid; grid-template-columns:repeat(8,1fr); grid-template-rows:repeat(8,1fr); width:var(--board-size); height:var(--board-size); box-shadow:0 8px 24px rgba(0,0,0,0.2);}
.cell {width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:32px; cursor:pointer; user-select:none; transition:0.1s; position:relative;}
.cell.light {background: var(--light);}
.cell.dark {background: var(--dark);}
.cell.selected{outline:3px solid var(--accent);}
.piece {transition:0.1s;}
#captured{display:flex; flex-direction:column; gap:12px;}
.captured-row{display:flex; gap:4px;}
.controls {margin-top:12px; display:flex; gap:10px;}
button {padding:8px 12px; border:none; border-radius:10px; cursor:pointer; font-weight:600;}
button:hover {transform:translateY(-2px);}
.btn-primary {background:linear-gradient(90deg,var(--accent),#60a5fa); color:white;}
#status {margin-top:8px; font-weight:600;}
</style>
</head>
<body>

<h1>Xadrez Moderno</h1>
<div id="container">
  <div id="board"></div>
  <div id="captured">
    <div>Peças capturadas:</div>
    <div id="whiteCaptured" class="captured-row">Brancas: </div>
    <div id="blackCaptured" class="captured-row">Pretas: </div>
  </div>
</div>
<div id="status">Turno: Branco</div>
<div class="controls">
  <button id="restartBtn" class="btn-primary">Reiniciar</button>
  <button id="backBtn">← Menu</button>
  <button id="muteBtn">Música: On</button>
</div>

<audio id="bgAudio" loop autoplay>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f3a7f3b6b.mp3?filename=soft-instrumental-110596.mp3" type="audio/mpeg">
</audio>

<script>
// ==== CONFIG ====
const board = document.getElementById('board');
const status = document.getElementById('status');
const restartBtn = document.getElementById('restartBtn');
const backBtn = document.getElementById('backBtn');
const muteBtn = document.getElementById('muteBtn');
const bgAudio = document.getElementById('bgAudio');
const whiteCaptured = document.getElementById('whiteCaptured');
const blackCaptured = document.getElementById('blackCaptured');

let boardState = [];
let selected = null;
let currentPlayer = 'white';

const initialSetup=[
  ["♖","♘","♗","♕","♔","♗","♘","♖"],
  ["♙","♙","♙","♙","♙","♙","♙","♙"],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["♟","♟","♟","♟","♟","♟","♟","♟"],
  ["♜","♞","♝","♛","♚","♝","♞","♜"]
];

// ==== FUNÇÕES ====
function createBoard(){
  board.innerHTML='';
  boardState=[];
  for(let r=0;r<8;r++){
    let rowArr=[];
    for(let c=0;c<8;c++){
      const cell=document.createElement('div');
      cell.classList.add('cell',(r+c)%2?'dark':'light');
      cell.dataset.row=r;
      cell.dataset.col=c;
      cell.textContent=initialSetup[r][c];
      board.appendChild(cell);
      rowArr.push(initialSetup[r][c]);
    }
    boardState.push(rowArr);
  }
}

function renderBoard(){
  board.querySelectorAll('.cell').forEach(cell=>{
    const r=parseInt(cell.dataset.row);
    const c=parseInt(cell.dataset.col);
    cell.textContent=boardState[r][c];
    cell.classList.remove('selected');
    if(selected && selected.r===r && selected.c===c) cell.classList.add('selected');
  });
}

// ==== MOVIMENTO SIMPLES + CAPTURA ====
board.addEventListener('click', e=>{
  const cell = e.target.closest('.cell');
  if(!cell) return;
  const r=parseInt(cell.dataset.row);
  const c=parseInt(cell.dataset.col);
  const piece = boardState[r][c];

  if(selected){
    // mover e capturar
    const capturedPiece = boardState[r][c];
    if(capturedPiece){
      if(capturedPiece===capturedPiece.toUpperCase()){
        whiteCaptured.textContent += capturedPiece+' ';
      } else {
        blackCaptured.textContent += capturedPiece+' ';
      }
    }
    boardState[r][c]=boardState[selected.r][selected.c];
    boardState[selected.r][selected.c]='';
    selected=null;
    renderBoard();
    // IA se branco jogou
    currentPlayer = currentPlayer==='white'?'black':'white';
    status.textContent=`Turno: ${currentPlayer==='white'?'Branco':'Preto'}`;
    if(currentPlayer==='black') setTimeout(aiMove,300);
  } else {
    if(piece!==''){
      selected={r,c};
    }
  }
});

// ==== IA BÁSICA ====
function aiMove(){
  let moves=[];
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const p = boardState[r][c];
      if(p && p.toLowerCase()!==p){ // peça preta
        // tentar mover aleatório adjacente
        const dirs=[[1,0],[0,1],[-1,0],[0,-1]];
        for(let d of dirs){
          const nr=r+d[0], nc=c+d[1];
          if(nr>=0 && nr<8 && nc>=0 && nc<8 && (!boardState[nr][nc] || boardState[nr][nc]===boardState[nr][nc].toUpperCase())){
            moves.push({from:{r,c},to:{r:nr,c:nc}});
          }
        }
      }
    }
  }
  if(moves.length>0){
    const m = moves[Math.floor(Math.random()*moves.length)];
    const capturedPiece = boardState[m.to.r][m.to.c];
    if(capturedPiece){
      if(capturedPiece===capturedPiece.toUpperCase()) whiteCaptured.textContent += capturedPiece+' ';
      else blackCaptured.textContent += capturedPiece+' ';
    }
    boardState[m.to.r][m.to.c] = boardState[m.from.r][m.from.c];
    boardState[m.from.r][m.from.c]='';
    currentPlayer='white';
    status.textContent='Turno: Branco';
    renderBoard();
  }
}

// ==== BOTÕES ====
restartBtn.addEventListener('click', ()=>{
  createBoard();
  whiteCaptured.textContent='Brancas: ';
  blackCaptured.textContent='Pretas: ';
  currentPlayer='white';
  status.textContent='Turno: Branco';
  renderBoard();
});
backBtn.addEventListener('click', ()=>{window.open('index.html','_self');});
muteBtn.addEventListener('click', ()=>{
  if(bgAudio.paused){bgAudio.play(); muteBtn.textContent='Música: On';}
  else{bgAudio.pause(); muteBtn.textContent='Música: Off';}
});

createBoard();
renderBoard();
</script>
</body>
</html>
